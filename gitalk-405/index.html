<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>记一次使用Github登录Gitalk跳至首页的解决过程 | Memorykk&#39;s blog</title>
<link rel="shortcut icon" href="https://memorykki.github.io/favicon.ico">
<link href="https://memorykki.github.io/styles/main.css" rel="stylesheet">
<link href="//at.alicdn.com/t/font_1678829_ntebi130zaa.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="Memorykk&#39;s blog » Feed" href="https://memorykki.github.io/atom.xml">


  <script async src="https://www.googletagmanager.com/gtag/js?id=G-61KQ1XYC4T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-61KQ1XYC4T');
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b89f2652bbc909bb41e06c21123d1797";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <meta name="description" content="使用自定义域名之后的 Github page 在使用 Github 登录 Github 时跳转首页，无限循环

问题
博客使用的是Hexo+Github+Gitalk，使用 Github 登录 Gitalk 之后跳转至首页，无限循环，地址栏..." />
  <meta name="keywords" content="Gitalk" />

  <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap.css" rel="stylesheet">
  <link href="https://memorykki.github.io/media/css/jquery.tocify.css" rel="stylesheet">

  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="https://memorykki.github.io/media/scripts/jquery.ui.core.js"></script>
  <script src="https://memorykki.github.io/media/scripts/bootstrap.js"></script>
  <script src="https://memorykki.github.io/media/scripts/jquery.tocify.js"></script>

  <style>
    #toc .nav-list > .active > a{
      border: 1px solid #000;
      border-radius: 10px;
      background-color: unset;
    }
    #toc a {
      color: #000000;
    }
    #toc {
      border: 0;
    }
  </style>
</head>

<body style="height: auto">
  <div id="toc" style="right: 20px; top: 80px"></div>
  <div class="main animated">
    <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <a href="https://memorykki.github.io">
        Memorykk&#39;s blog
      </a>
    </div>
  </div>
  <div class="my_socials">
    
      <a href="mailto:memorykki@gmail.com">
        <i class="iconfont"><svg t="1672505472759" class="icon" viewBox="-400 -400 1600 1600" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="656" width="25" height="25"><path d="M741.12 305.737143H276.114286L511.817143 528.457143z" fill="#606060" p-id="657"></path><path d="M524.8 566.857143a18.651429 18.651429 0 0 1-25.417143 0.182857l-62.72-59.245714L256 668.525714v49.737143h512v-49.737143l-181.577143-161.645714L524.8 566.857143zM256 337.005714v282.514286l153.965714-136.96zM768 619.52V330.788571l-155.245714 150.491429z" fill="#606060" p-id="658"></path><path d="M512 9.142857C234.24 9.142857 9.142857 234.24 9.142857 512S234.24 1014.857143 512 1014.857143 1014.857143 789.76 1014.857143 512 789.76 9.142857 512 9.142857z m292.571429 727.405714c0 10.057143-8.228571 18.285714-18.285715 18.285715H237.714286c-10.057143 0-18.285714-8.228571-18.285715-18.285715V287.451429c0-10.057143 8.228571-18.285714 18.285715-18.285715h548.571428c10.057143 0 18.285714 8.228571 18.285715 18.285715v449.097142z" fill="#606060" p-id="659"></path></svg></i>
      </a>
    

    
      
        <a href="https://github.com/memorykki" target="_blank">
          <i class="iconfont icon-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
    <a href="https://memorykki.github.io/atom.xml" target="_blank">
      <i class="iconfont icon-rss"></i>
    </a>
  </div>
</div>

<div class="header_menu">
  
  
  <a href="/" class="menu">Index</a>
  

  
  <a href="/archives" class="menu">Archives</a>
  

  
  <a href="/tags" class="menu">Tags</a>
  

  
  <a href="/about" class="menu">About</a>
  

  <div class="gridea-search-div">
    <form id="gridea-search-form" action="https://memorykki.github.io/search/">
      <input class="gridea-search-input" autocomplete="off" spellcheck="false" name="q" />
    </form>
  </div>
</div>

    <div class="autopagerize_page_element">
      <div class="content">
        <div class="post_page">
          <div class="post animated fadeInDown">
            <div class="post_title post_detail_title">
              <h1 class="indicator-free">
                <a>
                  记一次使用Github登录Gitalk跳至首页的解决过程</a>
              </h2>
              <span class="article-info">2021-02-19, 480 words, 3 min read</span>
            </div>
            <div class="post_content markdown">
              <p class="md_block">
                <span class="md_line md_line_start md_line_end">
                  <p>使用自定义域名之后的 Github page 在使用 Github 登录 Github 时跳转首页，无限循环</p>
<!-- more -->
<h1 id="问题">问题</h1>
<p>博客使用的是Hexo+Github+Gitalk，使用 Github 登录 Gitalk 之后跳转至首页，无限循环，地址栏URL显示为：</p>
<pre><code>https://memorykk.cn/?error=redirect_uri_mismatch&amp;error_description=The+redirect_uri+MUST+match+the+registered+callback+URL+for+this+application.&amp;error_uri=https%3A%2F%2Fdocs.github.com%2Fapps%2Fmanaging-oauth-apps%2Ftroubleshooting-authorization-request-errors%2F%23redirect-uri-mismatch
</code></pre>
<h1 id="解决过程">解决过程</h1>
<p>为了更清楚地检查，将此 URL 中的 Unicode 转为中文：</p>
<pre><code>https://memorykk.cn/?
error=redirect_uri_mismatch&amp;
error_description=The+redirect_uri+MUST+match+the+registered+callback+URL+for+this+application.&amp;
error_uri=https://docs.github.com/apps/managing-oauth-apps/troubleshooting-authorization-request-errors/#redirect-uri-mismatch
</code></pre>
<p>根据描述，<kbd>redirect error</kbd> <kbd>registered callback URL</kbd>不匹配。</p>
<p>打开<kbd>F12</kbd>查看<kbd>Network</kbd>：</p>
<figure data-type="image" tabindex="1"><img src="https://memorykki.github.io/post-images/gitalk-405/reirect_uri.png" alt="" loading="lazy"></figure>
<p><kbd>this application</kbd>我使用的是<kbd>OAuth Apps</kbd>，查看其Authorization callback URL，果不其然：</p>
<figure data-type="image" tabindex="2"><img src="https://memorykki.github.io/post-images/gitalk-405/Auth_callback_URL.png" alt="" loading="lazy"></figure>
<p><code>http</code>和<code>https</code>的差别还是很大的！修改Authorization callback URL为<code>https</code>之后成功了。</p>
<p>点击<kbd>使用GitHub登录</kbd>之后，又出现 405 问题，<br>
<img src="https://memorykki.github.io/post-images/gitalk-405/405.png" alt="" loading="lazy"><br>
打开<kbd>F12</kbd>查看<kbd>Network</kbd>：<br>
<img src="https://memorykki.github.io/post-images/gitalk-405/url1.png" alt="" loading="lazy"><br>
转换为中文：</p>
<pre><code>Request URL: https://memorykk.cn/TeamSpeak/%7B%7B%20theme.gitalk.proxy%20%7D%7D

Request URL: https://memorykk.cn/TeamSpeak/{{ theme.gitalk.proxy }}
</code></pre>
<p>好家伙，这还是源代码形式啊，坑定是后台有什么问题！<br>
检查<kbd>theme\layout\components\comment.ejs</kbd>，这行代码果然是从这里出来的：</p>
<pre><code>var gitalk = new Gitalk({
			clientID: '&lt;%= theme.gitalk_client_id %&gt;',
			clientSecret: '&lt;%= theme.gitalk_client_secret %&gt;',
			repo: '&lt;%= theme.gitalk_repo %&gt;',
			owner: '&lt;%= theme.gitalk_owner %&gt;',
			admin: ['&lt;%- theme.gitalk_admin.join(&quot;', '&quot;) %&gt;'],
			id: location.pathname,
			distractionFreeMode: false,
			createIssueManually: true,
			proxy: '{{ theme.gitalk.proxy }}',
		})
</code></pre>
<p>之前对node.js也不了解（虽然现在也一样，允悲），没注意格式。仿照上面几行代码改成：</p>
<pre><code>proxy: '&lt;%= theme.gitalk.proxy %&gt;',
</code></pre>
<p>还是报 405 错误，打开<kbd>F12</kbd>查看：<br>
<img src="https://memorykki.github.io/post-images/gitalk-405/405_2.png" alt="" loading="lazy"></p>
<p>总感觉之前白嫖的 CorsAnywhere Proxy 链接压根没有传递过去，直接手动写死在里面：</p>
<pre><code>proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token',
</code></pre>
<p>好家伙，成功了，ohhhhhhhhhhh，虽然这种做法极不优雅！</p>
<h1 id="总结">总结</h1>
<p>网页出错先用<kbd>F12</kbd>看看哪部分的问题，顺藤摸瓜，缩小范围。</p>
<br />
                  
              </p>
            </div>
            <div class="post_footer">
              
                <div class="meta">
                  <div class="info">
                    <span class="field tags">
                      <i class="iconfont icon-tag-sm"></i>
                      
                      <a href="https://memorykki.github.io/gitalk/" class="article-info">
                        Gitalk</a>
                      </span>
                  </div>
                </div>
                
              
                <div class="next-post" style="margin-top: 20px;">
                  <div class="next">下一篇</div>
                  <a href="https://memorykki.github.io/TeamSpeak/">
                    <h3 class="post-title">
                      TeamSpeak
                    </h3>
                  </a>
                </div>
                
            </div>
          </div>
          
          
          
              <div id="vcomments"></div>
              <script>
                  new Valine({
                      el: '#vcomments',
                      appId: 'krF0ARJcxpFRANhJvt8eQvzB-gzGzoHsz',
                      appKey: 'jNyN9UuoDD1qPl7aXI4bLWYU'
                  })
              </script>
          

        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="footer_slogan">
        
    </div>

    

    <p>
Powered by<a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
Theme<a href="https://github.com/kytrun/gridea-theme-one" target="_blank">One</a>
<br>
© 2020-2022<a href="https://memorykk.cn" target="_blank">Memorykk</a>
<a href="http://beian.miit.gov.cn" target="_blank">陕ICP备20005895号-1</a>
</p>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <p>
            user: <span id="busuanzi_value_site_uv"></span> site: <span id="busuanzi_value_site_pv"></span> page:
            <span id="busuanzi_value_page_pv"></span>
        </p>
    
</div>



<script src="https://memorykki.github.io/media/scripts/util.js"></script>


  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    $(function() {
        $("#toc").tocify({ selectors: "h2, h3, h4" });
    });
  </script>
</body>

</html>